<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:p="http://primefaces.org/ui"
	template="../templates/ui.xhtml">
    
    <ui:define name="head">
        <style type="text/css">
            .display {
                font-size: 36px !important;
            }
        </style>
        
        <script type="text/javascript">
            //<![CDATA[
                function handleMessage(data) {
                    var out = $('#output');
                    
                    out.append(data + '<br />');
                    out.scrollTop(out.height());
                }
            //]]>
        </script>
    </ui:define>

	<ui:define name="content">

			<h1 class="title ui-widget-header ui-corner-all">PrimePush - Scheduler</h1>
			<div class="entry">
			<p>Broadcasts can be delayed using <i>delay</i> feature and configured to run at periodic intervals using <i>schedule</i> feature. 
            This samples demonstrates a scheduled push in every 30 seconds.</p>
           
            <h:form>
                <p:commandButton value="Start" actionListener="#{broadcastScheduler.start}"  style="margin-bottom:20px" onclick="$(this).fadeOut()" 
                                 rendered="#{not broadcastScheduler.active}" styleClass="ui-corner-all"/>
            </h:form>
            
            <p:outputPanel id="output" layout="block" style="width:400px;height:200px;overflow:auto" styleClass="ui-widget ui-widget-content"/>
            
            <p:push onMessage="handleMessage" channel="schedule" />
            
            <h3>Source</h3>
            <p:tabView>
                <p:tab title="schedule.xhtml">
                    <pre name="code" class="xml">
&lt;h:form&gt;
    &lt;p:commandButton value="Start" actionListener="\#{broadcastScheduler.start}" style="margin-bottom:20px"
                                onclick="$(this).fadeOut()" rendered="#{not broadcastScheduler.active}" styleClass="ui-corner-all" /&gt;
&lt;/h:form&gt;

&lt;p:outputPanel id="output" layout="block" style="width:400px;height:300px;overflow:auto" styleClass="ui-widget ui-widget-content"/&gt;

&lt;p:push onMessage="handleMessage" channel="schedule" /&gt;

&lt;script type="text/javascript"&gt;
    //&lt;![CDATA[
        function handleMessage(data) {
            var out = $('#output');

            out.append(data + '&lt;br /&gt;');
            out.scrollTop(out.height());
        }
    //]]&gt; 
&lt;/script&gt;
                    </pre>
                </p:tab>
                
                <p:tab title="BroadcastSchedulerBean.java">
                    <pre name="code" class="java">
package org.primefaces.examples.view;

import java.util.Date;
import java.util.concurrent.TimeUnit;
import org.primefaces.push.PushContext;
import org.primefaces.push.PushContextFactory;

public class BroadcastSchedulerBean {
    
    private boolean active;

    public boolean isActive() {
        return active;
    }

    public void setActive(boolean active) {
        this.active = active;
    }
    
    public void start() {
        if(!active) {
            PushContext context = PushContextFactory.getDefault().getPushContext();
            context.schedule("/schedule", "Ping", 30, TimeUnit.SECONDS);
            
            active = true;
        } 
    }
}
                    </pre>
                </p:tab>
            </p:tabView>
		
		</div>
	</ui:define>
</ui:composition>
